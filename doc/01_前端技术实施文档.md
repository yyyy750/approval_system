# 审批系统 - 前端技术实施文档

## 1. 技术概述

| 技术 | 版本 | 说明 |
|------|------|------|
| React | 18.x | 用户界面构建库 |
| Vite | 5.x | 下一代前端构建工具 |
| TypeScript | 5.x | JavaScript 的超集，提供类型安全 |
| React Router | 6.x | 路由管理 |
| Axios | 1.x | HTTP 客户端 |
| Zustand | 最新 | 轻量级状态管理 |
| shadcn/ui | 最新 | 基于 Radix UI 和 Tailwind CSS 的组件库 |
| Tailwind CSS | 4.x | 实用优先的 CSS 框架 |
| React Hook Form | 最新 | 高性能表单验证库 |
| Zod | 最新 | TypeScript 优先的模式声明和验证库 |
| Lucide React | 最新 | 漂亮的图标库 |
| Sonner | 最新 | 简洁美观的 Toast 组件 |

## 2. 项目初始化

### 2.1 创建项目

```bash
# 使用 pnpm 创建 Vite + React + TypeScript 项目
pnpm create vite@latest frontend --template react-ts
cd frontend
pnpm install
```

### 2.2 目录结构

```
frontend/
├── public/                    # 静态资源
├── src/
│   ├── assets/               # 项目资源
│   ├── components/           # 公共组件
│   │   ├── ui/               # 基础 UI 组件 (shadcn/ui)
│   │   ├── layout/           # 布局组件 (Sidebar, Header, MainLayout, etc.)
│   │   └── business/         # 业务组件
│   ├── pages/                # 页面组件
│   │   ├── admin/            # 管理员页面 (MemberManagement, WorkflowConfig)
│   │   ├── approval/         # 审批相关页面 (List, Create, Detail)
│   │   ├── auth/             # 认证页面 (Login, Register)
│   │   ├── dashboard/        # 仪表盘
│   │   ├── notifications/    # 通知页面
│   │   └── profile/          # 个人资料
│   ├── hooks/                # 自定义 Hooks
│   ├── services/             # API 服务
│   ├── stores/               # 状态管理 (auth, sidebar)
│   ├── types/                # TypeScript 类型定义
│   ├── utils/                # 工具函数
│   ├── constants/            # 常量定义
│   ├── styles/               # 全局样式
│   ├── App.tsx               # 应用根组件 (路由配置)
│   └── main.tsx              # 入口文件
├── .env.development          # 开发环境变量
├── .env.production           # 生产环境变量
├── tsconfig.json             # TypeScript 配置
└── vite.config.ts            # Vite 配置
```

## 3. 核心配置

### 3.1 Vite 配置 (vite.config.ts)

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
      },
    },
  },
})
```

### 3.2 路径别名 (tsconfig.json)

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```

### 3.3 路由与权限配置

应用使用 `react-router-dom` 进行路由管理，并结合自定义的高阶组件实现权限控制。

- **PublicRoute**: 公开路由（如登录、注册）。如果用户已登录，访问这些页面会自动重定向到仪表盘。
- **ProtectedRoute**: 受保护路由。用户必须登录才能访问。支持 `allowedRoles` 属性，用于基于角色的访问控制（RBAC）。

**核心路由结构 (App.tsx):**

- `/` -> 重定向到 `/dashboard`
- **Auth (Public)**
  - `/login`: 登录页
  - `/register`: 注册页
- **Main (Protected)**
  - `/dashboard`: 仪表盘
  - `/approval`: 审批列表
  - `/approval/new`: 发起审批
  - `/approval/:id`: 审批详情
  - `/profile`: 个人资料
  - `/notifications`: 消息通知
- **Admin (Protected + Role: 'admin')**
  - `/admin/users`: 成员管理
  - `/admin/workflows`: 流程配置

## 4. Axios 封装

```typescript
// services/api.ts
import axios from 'axios'

const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000,
})

// 请求拦截器 - 添加 Token
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// 响应拦截器 - 统一错误处理
api.interceptors.response.use(
  (response) => response.data.data,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('token')
      window.location.href = '/login'
    }
    return Promise.reject(error)
  }
)

export default api
```

## 5. 状态管理 (Zustand)

```typescript
// stores/authStore.ts
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

interface AuthState {
  user: User | null
  token: string | null
  login: (user: User, token: string) => void
  logout: () => void
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      login: (user, token) => set({ user, token }),
      logout: () => set({ user: null, token: null }),
    }),
    { name: 'auth-storage' }
  )
)
```

### 5.2 侧边栏状态 (Sidebar Store)

用于管理应用侧边栏的展开/折叠状态。

```typescript
// stores/sidebarStore.ts
// ... (implementation using zustand/persist)
```

## 6. UI 组件与布局

项目采用 **shadcn/ui** 作为基础组件库，配合 **Tailwind CSS** 进行样式定制。

### 6.1 布局组件 (src/components/layout)

- **MainLayout**: 主布局容器，包含 Sidebar 和 Header。
- **Sidebar**: 侧边导航栏，根据用户角色显示不同的菜单项。
- **Header**: 顶部导航栏，包含面包屑导航 (Breadcrumbs) 和用户操作区。
- **Breadcrumbs**: 动态面包屑组件，基于当前路由路径生成。
- **PageContainer**: 页面内容容器，统一页面内边距和标题样式。

## 7. 开发命令

```bash
pnpm dev       # 启动开发服务器
pnpm build     # 构建生产版本
pnpm lint      # 代码检查
```
